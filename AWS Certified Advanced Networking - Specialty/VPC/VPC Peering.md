## VPC Peering

![image](https://user-images.githubusercontent.com/67897827/190904856-0fd4ab00-3dbc-40bf-9a9a-1d42cffb7632.png)


![image](https://user-images.githubusercontent.com/67897827/190904950-ba27b980-1fcd-495a-bf10-1982c361b20c.png)

![image](https://user-images.githubusercontent.com/67897827/190905003-9d2204b6-5fb0-4122-8623-f41b7ac75a0d.png)


![image](https://user-images.githubusercontent.com/67897827/190905082-b95d8a6e-4709-489e-a743-b88ed2ab24dd.png)

여기 그림은 설명을 덧붙이면 우선 퍼블릭 IPv4 DNS 호스트 이름을 프라이빗 IPv4주소로 확인하도록 설정해야 되는데
즉 VPC Peering DNS Resolution 을 비활성해 하면 퍼블릭 IPv4주소를 리턴하게 된다. -> 이렇게 되면 인터넷을 통해서 퍼블릭 DNS가 라우팅 된다.
반대로 활성화 해주게 되면 프라잇빗 IPv4주소를 리턴하게 되서 프라이빗하게 통신 할 수있다. 


![image](https://user-images.githubusercontent.com/67897827/190907125-ce762075-5420-42c5-9876-0c4ecf86df47.png)

이렇게 하면 각각의 계정에서 각각의 VPC에 리소스를 따로따로 만들지 않고 Shared Service VPC의 공통적인 리소스를 만들어줘서 이 리소스를 여러개 계정에 공유해서 사용가능.

(실습)  
VPC를 각각 두개생성(같은 리전이어도 되고 다른 리전도 되고 다른 계정도 상관없다.) -> 각각 VPC에 서브넷 생성,인터넷게이트웨이 생성(작업에서 VPC연결,VPC만들때 생성된 라우팅테이블
라우팅에 가서 라우팅 편집눌러 라우팅추가해서 0.0.0.0/0 target 인터넷게이트웨이로 하고,후에 라우팅테이블을 서브넷에 연결)
-> VPC 1번에 작업에서 DNS 호스트 이름 편집 눌러서 활성화 클릭 -> 왼쪽바에 피어링 연결 클릭 생성누르기 -> 이름은 vpc-peering,요청자는 VPC 1번이 요청하는걸로,내계정,현재리전
(각 상황에 맞게),수락자는 VPC 2번 후 연결생성 -> 다시 피어링 연결 탭 들어가서 작업에 요청수락 해야된다

이 상황까지는 연결 활성화는 되었는데 IP 주소로 트래픽이 라우팅 되지 않는다 라우팅 테이블을 구성해 줘야한다.

왼쪽 라우팅 테이블 탭 에서 VPC 1번 퍼블릭 라우팅 클릭해서 밑에 라우팅 클릭해 편집누르기 -> 추가해서 VPC 2번의 사이더블럭인 10.2.0.0/16 target에 피어링연결 클릭하고 저장
(마찬가지로 VPC 2번에 라우팅 테이블가서 똑같은 작업해주기) 확인하기 위해 EC2 하나 만들기(지금상태는 VPC 1번에 관련한 EC2만 있는상태라) -> 설정으 윈도우2016base,네트워크는
VPC2로 맞춰주고 퍼블릭 IP자동할당 활성화,태그는 Name vpc-02-ec2,보안그룹은 새로 만들기해서 해서 모든 트래픽을 0.0.0.0/0하고 월래있는건 지우고 그 후 VPC 1에 있는 보안그룹도
모든 트래픽허용하는 걸로 보안그룹 바꿔주기 그 후 VPC 1번에 있는 EC2로 원격 접속하기 -> 원격 창에서 또 remote desktop connection IP치는 란에 VPC 2번에서 만든 EC2
프라이빗 IP주소 복사하기(VPC끼리 피어링 됬으니 프라이빗IP도 가능) 이런식으로 확인!! 

또 여기서 왼쪽탭에 피어링 연결 클릭해서 작업에 DNS 설정 편집 누르기 -> 요청자 수락자 DNS확인 체크해주고 -> 다시 원격으로가서 nslookup (퍼블릭 DNS) 하게 되면 월래
퍼블릭 IP뜨는것이 프라이빗 IP로 바뀐다.

즉 퍼블릭 DNS 호스트 이름을 프라이빗 IP 주소로 확인하도록 설정할 수 있따.!!!!!!11






