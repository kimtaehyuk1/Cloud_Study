한번 지워졌다 다시 핵심만 쓴다...ㅠㅠ

![image](https://user-images.githubusercontent.com/67897827/189288214-8ee69b3e-d460-40f6-87ed-fdd4aff918f0.png)
우선 여기 그림 구성도 머리에 박기

우선적으로 VPC 사이더 블럭의 /16이 VPC안의 서브넷/24보다 더 범위가 넓은것임.

그림을 설명해보면, 처음 VPC를 생성하게 되면 NACL과 라우팅 테이블이 생긴다. (여기선 따로 NACL과 라우팅 테이블을 하나씩 추가로 만들어준거다) 다음으로 서브넷을 만들어준다.
라우팅 테이블과 서브넷이랑 각각 연결해주고 나면 같은 VPC내 다른 서브넷과 통신이 가능한것이다.
인터넷게이트웨이는 생성하면 VPC와 연결하고 퍼블릭 서브넷 라우팅 테이블에 항목 추가 (또 네트워크 인터페이스에서 퍼블릭 서브넷의 퍼블릭 IP가지고 있는것이 아니라
인터넷게이트웨이가 퍼블릭 IP가지고 있고 1:1 NAT을 통해 바깥과 통신가능하게 해준다.)

서브넷 생성후에는 AWS는 처음 4개 IP주소와 마지막 1개 IP주소를 미리 예약해놓는다.

![image](https://user-images.githubusercontent.com/67897827/189292030-0e76153f-b306-4707-a501-f709f1537222.png)

여기서 대상은 예를들어 그림처럼 10.1.0.0/16안에 들어오는 IP대역(대상)은 타겟(대상)에 있는 항목을통해(예를들면 인터넷게이트웨이) 트래픽을 보내겠다 이런뜻이다.
(local은 걍 VPC 내부라 생각) 

EC2 Networking : Elastic IP (탄력적 IP)  
• 인스턴스 생성시 자동으로 할당 받은 Public IP는 인스턴스를 재시작 하면 다른 IP로 재할당받기에 Public IP 주소가 변경됨  
• Elastic IP는 인터넷에 연결 가능한 고정적(정적)인 퍼블릭 IP 주소  
• EC2인스턴스의 ENI에 탄력적 IP주소를 연결하면 EC2인스턴스를 다시 시작해도 동일한 IP주소로 접속할 수 있음  

(실습)  
탄력적 IP 칸에서 생성하고 작업가서 탄력적 IP주소 연결눌러 퍼블릭 인스턴스에 연결

![image](https://user-images.githubusercontent.com/67897827/189685525-41bbe840-aa71-444c-9869-6d7c8dc672b0.png)

Security Group (보안 그룹)  
• 인스턴스에 대한 인바운드 및 아웃바운드 트래픽을 제어하는 가상 방화벽 역할  
• 서브넷 수준이 아니라 인스턴스 수준에서 작동(EC2인스턴스의 ENI와 연결 됨)  
• 하나의 EC2 인스턴스 ENI에 5개까지 보안그룹연결 가능  
• 보안 그룹은 허용 규칙만 지정 가능하고 거부 규칙은 지정 할 수 없음  
• 보안 그룹은 연결 상태를 추적하는 상태저장 방화벽 (Stateful Firewall)  
• 보안 그룹은 생성된 VPC 내에서만 사용 가능  

![image](https://user-images.githubusercontent.com/67897827/189687045-8ff4bb78-ca0c-4968-8e48-f84c05680e9f.png)

보안 그룹에서 아웃바운드는 모든 트래픽이 허용이 되있다.
또여기서 보안그룹은 상태저장이 중요한데 이건 밑의 그림을 보자

![image](https://user-images.githubusercontent.com/67897827/189687897-09d4937c-22d6-47c4-b71a-59372aa3c794.png)

그림에서 사용자가 인스턴스에서 요청을 전송한다는 뜻은 인스턴스에서 클라이언트로 나갈때 즉 아웃바운드로 나가면 들어올때 묻고 따지지 않는다는 내용

Network Access Control List (NACL)  
• 서브넷 내부와 외부의 트래픽을 제어하는 방화벽  
• 서브넷 레벨의 연결 방화벽  
• 하나의 NACL은 여러 서브넷과 연결 가능  
• 하나의 서브넷은 하나의 NACL만 연결 가능  
• NACL은 허용, 거부 규칙 모두 지정 가능  
• NACL은 연결 상태를 추적하지 않는 상태 비저장 방화벽 (Stateless Firewall)  
✓ 인바운드 트래픽에 대한 응답은 아웃바운드 트래픽 규칙을 따름  
✓ 아웃바운드 트래픽에 대한 응답은 인바운드 트래픽 규칙을 따름  
• EC2 웹서버 운영시 외부에서 Client가 접속 후 리턴 트래픽을 받을 때 NAT를 사용하므로 임시포트(ephemeral ports) 1024-65535를 사용  

![image](https://user-images.githubusercontent.com/67897827/189816643-40ccabdd-5e58-4bd5-8513-4d5686a54663.png)


디폴트 NACL 인바운드,아웃바운드 규칙은 기본적으로 모든 트래픽이 허용되어있다.
새로 NACL생성 하면 인바운드, 아웃바운드 모든 트래픽이 거부 되어있다.

![image](https://user-images.githubusercontent.com/67897827/189817539-baf36d09-63b5-4d4f-b932-c1877ea3a06a.png)








