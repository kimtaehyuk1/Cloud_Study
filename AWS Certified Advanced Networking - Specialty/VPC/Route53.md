DNS (Domain Name System) & Route 53  
• DNS는 사람이 읽을 수 있는 도메인 이름(예: www.amazon.com)을 컴퓨터가 읽을 수 있는 IP 주소(예: 192.0.2.44)로 변환하는 시스템  
• Route 53은 AWS에서 제공하는 DNS (Domain Name System) 서비스  
• Route 53의 기능  
✓ 퍼블릭 도메인 구매 또는 이전 (.com, .net, .co.kr)  
✓ AWS내부 VPC에서만 사용할 수 있는 프라이빗 도메인 생성  
✓ 라우팅 정책 적용(단순 라우팅, 가중치기반, 지리적위치, 지연시간, 장애조치, 다중값 응답)  

![image](https://user-images.githubusercontent.com/67897827/189944647-572c9202-2063-4d7d-969e-993a073ee140.png)


차근 차근 과정 읽어보기
![image](https://user-images.githubusercontent.com/67897827/189946327-8b2d71db-1c53-4575-a229-1a2d8cf0d66b.png)

![image](https://user-images.githubusercontent.com/67897827/189953912-2a1ae4c6-60b3-4fee-9f31-f883ef75db1d.png)

참고로 Route53서버가 IP주소 반환할때 TTL이라는것을 반환하는데..즉 DNS리졸버가 이 레코드에 관한 정보를 캐싱해 가지고 있는 시간이다.(그 시간안에 또 접속하면
위의 복잡과정 안거치고 바로 받을 수 있것지)

DNS 서비스를 사용할 때 레코드라는 것을 사용하는데 이건 DNS서비스의 특별한 정보가 저장된 항목을 레코드라 한다.

![image](https://user-images.githubusercontent.com/67897827/189948980-011eb632-9b3f-4530-91b5-5b99fef03e9c.png)

쉽게 레코드를 가지고 도메인을 여리저리 라우팅하는 거라고 생각하자!!
처음 DNS를 생성하면 NS레코드(특정 도메인네임의 정보를 가지고 있는 DNS를 식별하기 위한 레코드)와 SOA레코드(도메인의 정보와 권한을 가진 레코드)가 디폴트로 생김

## 단순 라우팅
![image](https://user-images.githubusercontent.com/67897827/189951346-87e3f998-d0c1-43b4-8f9a-61ad18408d18.png)

(체크부분) IP주소를 가지고 있는것이 (Route53의 DNS에 호스팅영역에서) 레코드 값에서 가지고 있다! 근데 반환할 IP주소를 여러개 가지고 있으면 랜덤하게 라우팅 됨

(실습)단순라우팅
지금 상황이 머냐면 웹서버(EC2 인스턴스) 3개를 만들어준 상황이고 대상그룹에 추가했고 로드밸런서도 함께 만들어준 상황  
여기서 Route53에서 호스팅 영역 들어가서 만들어준 퍼블릭 도메인(돈내고 만들어야됨)눌러서 레코드 생성 누르기 -> 이름은 걍 simple로, 레코드 유형은 A, 값에 다가는 만들어준 웹서버1번 퍼블릭 ip주소 입력
(그러니까 이런식으로 simple.~.com 했을때 저 IP로 값이 반환하는 느낌이지 그걸 여기서 만들어 주는겨) 또 IP주소 여러개 입력도 가능하다, TTL은 1분으로, 라우팅정책은
단순라우팅 클릭

비슷하게 레코드 생성칸에서 값 옆에 별칭으로 바꾸고 ALB(다른 것도 되지만 난 ALB만들어서)로 해주면 방금 만든 도메인으로 접속하면 aws ALB로 접속이 된다
그럼 그 안에 속한 대상그룹에서 랜덤 LB되것지 즉 IP주소가 아니라 여긴 ALB로 라우팅이 되는거다.

## 가중치 기반 라우팅
![image](https://user-images.githubusercontent.com/67897827/189955211-80d4554d-154f-4411-ac42-c1e79d5a8e9c.png)


(실습)  
위와 같이 레코드 생성눌러서 이름 써주고, 유형은 A,값은 웹서버1 IP 넣고,TTL은 1분, 라우팅정책을 가중치 기반 하고 50두기,레코드 ID아무거나 입력 -> 이런식으로
다른 레코드 추가해서 가중치만 다르게 하기(이름은 똑같이,값은 당연히 다르게) 두번째 가중치는 50으로 하면 같은 도메인으로 접속하면 50:50 확률로 웹서버 다르게
접속 될 것이다.

## 지연시간 라우팅
![image](https://user-images.githubusercontent.com/67897827/190398152-78602c77-bfb0-4074-b574-e9cda7e80bfe.png)

(실습)  
위와 마찬가지로 만든 도메인 호스팅영역에서 레코드 생성 누르기 -> 이름은 latency,레코드유형은A레코드,값은 웹서버1번 퍼블릭IP 붙이기,TTL은 1분,라우팅정책을 지연시간
,리전은 서울리전선택,레코드ID는 latency-1,으로 하고 -> 다른 레코드 추가 눌러서 위와 똑같이 설정하는데 값만 웹서버2번으로하고, 리전을 미국동부로 선택

즉 이 말은 latency.~.com으로 접속했을때 지리적위치가 서울과 가까우면 아까 처음 리전을 서울로지정한 웹서버1로 접속하게 되고 미국에 가까우면 웹서버2로 접속하게 된다.

## 지리적 위치 라우팅
![image](https://user-images.githubusercontent.com/67897827/190399787-c7ff02fe-b94d-47e5-af13-77992ec74823.png)

(실습)  
마찬가지로 레코드 생성하는데 이름을 geo,유형은A,값은 웹서버1번 퍼블릭 IP, TTL은 1분, 라우팅정책은 지리적위치로,위치는 아시아,레코드 ID는 geo-1 -> 다른 레코드 추가해서
값을 웹서버2번으로, 위치는 북아메리카 만 바꿔주고 

즉 클라이언트가 아시아에 속해있으면 그놈은 웹서버1로 라우팅 받을 것이고, 북아메리카에 속해 있으면 웹서버2로 라우팅 받을 것이다.

## 장애조치 라우팅
![image](https://user-images.githubusercontent.com/67897827/190400961-019d84bb-0eaa-4b4b-bc81-a365e13819d4.png)

Failover라우팅할때 이 상태검사 구상을 미리 해줘야 된다.
![image](https://user-images.githubusercontent.com/67897827/190401778-2721a62f-c36d-4dcb-abd1-1d30b68a31b8.png)

(실습)  
Route53 가서 왼쪽 탭에 상태검사 클릭 생성 눌르기 -> 이름을 WEBSERVER_01,모니터대상은 엔트포인트,IP주소로 체크 프로토콜은 HTTP, IP주소에는 웹서버 퍼블릭 IP 붙여넣기는
포트는 80, 고급 구성에서 난 실습을 위해 빠름에 2번으로 하고 다음누르고 알림은 안받는다하고 상태검사 생성 누르기 -> 똑같이 이제 WEBSERVER_02도 해주기
-> 다시 호스팅영역에 도메인눌러서 레코드 생성누르기 -> 레코드이름 failover,A유형,값에는 웹서버1번 퍼블릭 IP,TTL은 1분,라우팅정책을 장애조치로,장애조치 레코드 유형을
기본으로(이 웹서버는 primary웹서버 되는거),상태검사를 WEBSERVER_01클릭,레코드ID는 failover_01로 하고 다른 레코드 추가해서 위와 똑같이 하는데 웹서버2 IP넣고 장애유형을
보조로만 바꿔서 하나 만들기

이렇게 되면 웹서버1번(기본)에 문제생기면 웹서버2번으로 라우팅됨

웹서버 1번 문제생기게 하기 위해 EC2 웹서버1에서 밑에 네트워킹 눌러 인터페이스 ID 눌러 ID클릭후 오른쪽 상단 작업에 보안그룹 변경하기 보안그룹을 default로 선택(이건 HTTP가
허용 되어있지 않다) 이렇게하고 Route53 상태검사가면 비정상으로 되있을겨 그 다음 failover.~.com만든거 가면 이젠 기본이 아닌 보조 웹서버2로 접속되는거 볼 수 있다.

## 다중값 응답
![image](https://user-images.githubusercontent.com/67897827/190405357-5cf6b508-b2b2-4686-b921-81c39de58440.png)

(실습)  
마찬가지로 레코드생성 -> 이름은 multi,유형은A,IP값은 웹서버1의 퍼블릭 IP값,TTL은 1분,라우팅정책은 다중값 응답,레코드이름 multi-01하고 다른 레코드 추가해서 똑같이 IP값만
다르게 해서 한개 만들고 생성누르기

이것도 상태검사해서 비정상이 감지되면 IP주소를 반환하지 않는다.

## Route 53 Private Hosted DNS Zones
• Amazon VPC 내에서 트래픽을 라우팅  
• 프라이빗 Domain Name을 프라이빗 IP 주소로 변환 하여 라우팅  
• 프라이빗 호스팅 영역을 VPC에서 사용하려면 VPC 설정의 DNS 호스트 이름 (DNS Hostname) 과 DNS 확인 (DNS Resolution)을 활성화 해야 함.  

DNS Hostname은 쉽게 말해서 VPC내에서 프라이빗 영역에서 호스트 네임을 사용하겠다는 것이다.
DNS Resolution은 쉽게 말해 VPC내에서 DNS를 사용하겠다는것이다.

VPC - DNS  
• DNS 호스트 이름과 DNS 확인은 프라이빗 호스팅 영역에 대한 필수 설정  
• 프라이빗 호스팅 영역에 대한 DNS 쿼리는 Amazon 제공 VPC DNS 서버에서만 확인 가능  
DNS Hostname  
• 기본(Default) VPC가 아닌 새로 생성한 Custom VPC의 경우 이 옵션은 기본적으로 비활성화되어 있음  
• 프라이빗 호스팅 영역을 사용하려면 이 옵션을 활성화 해야 함  
DNS Resolution  
• 프라이빗 호스팅 영역은 VPC DNS 서버로부터의 DNS쿼리만 수락  
• VPC DNS 서버의 IP 주소는 VPC IPv4 네트워크 범위를 기준으로 2를 더한 예약된 IP 주소(예, 10.1.0.2)!!!!!!!!!!!!  
• DNS 확인(DNS Resolution)을 활성화하면 DNS 확인을 수행하기 위한 확인자(Resolver)로서 VPC DNS 서버를 사용할 수 있음  

DNS서버를 사용하는 옵션값들이 있는데 이 옵션값이 DHCP Option Sets
이것은 호스트에대한 구성정보를 전달하기위한 파라미터이다.

![image](https://user-images.githubusercontent.com/67897827/190414762-098f7009-ad2f-435f-b379-2b4505265d59.png)

(실습)  
Route53에서 왼쪽에 호스팅 영역있다 눌러서 호스팅 영역 생성 클릭 -> 프라이빗 호스팅영역 도메인 이름이니까 아무렇게나 짓기 internal.inostudy.com, 유형은 프라이빗 호스팅 영역 으로 지정 , 호스팅 영역과 연결한 VPC(이 연결된 VPC에서만 internal.inostudy.com 이거 사용가능) 그 후 호스팅 영역생성 

호스팅 영역과 연결할 VPC로 가보면 세부정보에 DNS 호스트 이름 비활성화되있는거 활성화 해줘야한다(오른쪽 상단에 작업에서 DNS 호스트 이름 편집눌러서 활성화)

DNS확인은 활성화되있는데 이 DNS확인은 DNS를 사용하겠다는 건데 어떻게 사용하냐? 바로 DHCP 옵션 세트의 값을 참조해서 사용하는것이다.

(실습)  
커스텀으로 DHCP옵션세트를 만들어 줄 수 있는데 VPC있는 왼쪽 바에 DHCP 옵션세트라고 있고 오른쪽 상단에 생성이있다 -> 이름 my-dhcp, 도메인이름을 internal.inostudy.com으로하고, 도메인 네임 서버는 별도로 운여하고있으면 입력해줄수 있다 밑에껏도 별도로 있으면 입력은 가능

![image](https://user-images.githubusercontent.com/67897827/190424016-d9921780-5c6e-441d-b79a-39c149b76df0.png)


