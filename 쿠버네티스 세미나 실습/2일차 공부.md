## 2일차- 가상 네트워크 인프라 개요

쿠버네티스에서의 네트워크 유형과 다양한 기업에서 필요로하는 기능들을 쿠버네티스 내에 적용하기 위해 다양한 네트웍플러그인을 선택할수 있게 제공하고있다.
네트워크 플러그인에는 어떤것들이있고, 성능비교해보고 네트워크에 대한 보안 살펴보기

!!!
(또 생각이 드는것인데 도커라는것이 이미지가 컨테이너 환경에 하나의 컨테이너(애플리케이션)으로 배포된다는 느낌으로 생각하기)
**1. 컨테이너에대한 네트워크 인프라에 대해**
컨테이너간 통신(--link)

들어가기 전에 도커에대한 잠깐 실습
실습은 영상과 함께 따라해보기( katacoda.com에서 Deploy Static HTML Website as Container로 실습)
첫번째 실습은 도커파일을 작성해서 이걸 이미지로 만들고 이 이미지 이용해서 컨테이너로 웹을 배포하는 시나리오이다. 자세한것은 영상들으면서 따라해봄.
FROM 이라는 구문을 가지고 기존에 존재하는 이미지를 가지고 수정해서 사용 가능 COPY로 어디에 할건지 경로
docker build -t webserver-image:v1 . (도커 빌드하는데 태그인데 뒤에는 이름이고 .은 경로이다 이렇게 하면 이미지가 만들어진거)
docker run -d -p 80:80 webserver-image:v1
(다음으로 run으로 컨테이너 실행할수 있는데 근데 보통 웹서버는 데몬형태로 리슨포트를 가지고 동작하는데 다시말해 프론트엔드 서비스로서 외부의 request를 받아서 처리하는
특징을 가지기 떄문에 우리의 이미지 가지고 컨테이너를 올릴때 몇가지 옵션이 필요한데, -d : 데몬으로=백그라운드로, 또 호스트의 포트를 맵핑시켜주는 포트포워딩이 필요하다
컨테이너는 컨테이너 ip가 부여되지만 사설이기 때문에, 호스트가 외부서비스가 가능해야되고 외부에서 요청을 받을수있는 호스트의 인터페이스의 포트와 맵핑이 필요한것이다. -p 뒤의
처음 80이 호스트포트이고 뒤는 컨테이너 안에서 사용하는 리슨포트 이다)
또 올린 컨테이너에 대해 가상 네트워크 인터페이스를 제공하고, ip를 제공하게 되는데 이정도를 docker inspect d45(컨테이너 ID인데 3글자만 줘도됨) ID모르면
(docker ps 로 올라간 컨테이너 정보확인) 

결국 내가 앱을만들어서 배포할때도 이런 과정으로 하면된다.

**link라는 것을 이용해서 컨테이너간의 통신을 쉽게 할수 있게 제공한다**
사실 컨테이너간에 서브넷이다르면 직접적으로 통신을 할때 별도의 매커니즘이 필요한데 link를 쓰면 쉽게 할 수 있다.
요것도 카타코다 에서 실습따라해보면서 익히기
여기서는 먼저 redis를 이용해서 data store를 컨테이너로 먼저 배포를 한다. docker run -d --name redis-server redis (redis라는 공식 이미지 사용 아까랑 다르게 우리가 만든걸 앞에는 
걍 옵션으로 이름 붙여준것
빌드한것이 아니라, redis라는 이미로 컨테이너에 올렸다.)
그다음으로 컨테이너간에 그 이름으로 통신을 하도록 링크라는 옵션으로 컨테이너를 배포할수있다. 두번째 컨테이너는 링크옵션 이용해서 배포해보자
docker run --link redis-server:redis alpine env ( 쉽게 alpine이라는 이미지를 가지고 컨테이너를 배포할때 host에 등록을 
redis라는 이름으로 redis-server와 링크를 등록한다.그후에 배포된 컨테이너에서 env라는 명령어 실행) 
**즉 redis라는 alias의 이름을 가지고 서로 다른 컨테이너에서 접근 가능** 
**또 docker run --link redis-server:redis alpine cat /etc/hosts 이명령어 쳐서 alpine이미지의 배포된 컨테이너의 host파일을 보게되면 내가 링크이름으로 지정한 redis 즉
링크로 지정한 다른 컨테이너 이름이 host파일에 들어간다 이것이 링크의 개념 등록된 alias이름으로 서로간의 통신이 가능하다.**

근데 이건 docker ps를 alpine이라는 이미지의 컨테이너는 보이지 않는데 그이유는 ps는 run중인 컨테이너만 보이므로, 우리가 한거인
이 안에는 데몬형태의 서비스가 없는 상황이므로 추가적으로는 도커 이미지에는 서비스 명령을 품은 이미지와 그렇지 않은 이미지 두가지 종류가 존재한다 이 alpine은 데몬에서 돌아가는
서비스 형태가 아닌 이미지라 이해)

포트 포워딩할때 이 컨테이너내의 서비스가 사용하는 포트를 명시하면서 호스트 포트와 포트포워딩하는건데 그건 어떻게 아냐면
docker history (이미지이름)
이렇게 하면 도커파일안에 어떠한 구문으로 이놈이 컴파일했고 이미지 빌드했는지 도커파일의 명세서 확인할수 있다. 거기서 EXPOSE라는 구문을 명세하는데 이걸통해서
현제 이 이미지가 어떠한 서비스 포트를 사용하는지를 알수있다. 즉 남이 만든 이미지를 가지고 내가 컨테이너를 올려서 사용하겠다 싶으면 먼저 (docker pull 이미지이름 은
이미지 다운 받을때 쓰고 -> docker history로 포트나 볼륨이런거 봐야된다 그래야 -p나 -v옵션을 정확히 해야 제대로 동작하는 컨테이너 올릴수 있다.)

위의 시나리오 정리해준 부분이 영상 50분 가량 쯤에 있당!


