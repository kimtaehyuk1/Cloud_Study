## 컨테이너의 네트워크 유형

기본은 bridge모드 타입으로 사용한다. 도커가 설치가 되면 docker0라는 브릿지타입에 스위치가 만들어지고 기본적으로 컨테이너는 docker run 했을때 이 기반으로 올라간다.


<img src="https://user-images.githubusercontent.com/67897827/155008542-a56de419-00e8-4d7b-8901-3c505137cdaa.PNG" width="800" height="400">

4.에서 월래 컨테이너는 네트웍 네임스페이스라는 기술로 호스트와 격리가 되는데 이건 공유함.
특히 쿠버네티스에서는 네트워크 플러그인을 설치를 하는데 그 네트웍플러그인 컨테이너들은 
호스트의 네트웍을 직접 바라보아야 그 위에 쿠버네티스 기반의 컨테이너들이 통신을 할 수 있게끔 동작 시킬수 있다.

5. macvlan타입으로 스위치를 생성할수있다. 이 기반으로 컨테이너 올렸다 그러면 해당 물리망과 연동.
6. overlay 네트웍이라 해서 이건 도커 클러스터모드에서 사용하는 모드임. 터널링 프로토콜을 이용해서 가상의 서로 다른 노드의 컨테이너가 배포가 되어도 가상의 네트웍 통해서
하나로 연동해서 통신할수 있게끔 구성 (이건 클러스터 모드에서 사용가능)

**도커를 이용해서 리소스를 관리할때 크게 4가지 카테고리인 네트웍,컨테이너,이미지,스토리지**

월래는 docker0라는 스위치에 컨테이너가 붙는데 우리가 사진밑에 명령어와 같이 네트워크를 만들었다하면 월래것과 서브넷이 다르기 때문에 기본적인 상식은
둘이 통신이 안될것이다. 그래서 어떠한 스위치기반으로 컨테이너 올릴지 지정해줘야한다.

이것또한 카타코다에서 실습해보자
다른 네트워크에서 올리면 전 실습처럼 --link사용 안했기에 같은 스위치에 올라간 컨테이너에 대한 정보는 아무것도 없다.
하지만 같은 네트웍(스위치)에서 ping을하기위한 또다시 새로운 컨테이너를 만들고 같은스위치에있는 다른 컨테이너 이름으로ping을 때리면 통신이 된다!!
왜되냐하면 도커에는 자체적으로 내부 DNS가 내장되어 있어서 이름을 통해서 통신이 된다.
**--link는 etc/host나 환경변수에 명시된 서버정보가 등록이 되서 쫌더 쉽게 로컬에서 바로바로 접속하는 방식이고 이놈은 DNS통해서 통신이 가능한 놈이다.
즉 같은 스위치에 연결된놈끼리 통신이 된다는 소리이다. **

또 다른 네트워크 만들어서 그쪽에서는 다른놈 네트워크에있는 컨테이너에 connect해서 그 컨테이너는 두개의 서브넷ip를 가질수있게 될 수 있게된다.

**컨테이너 보안**
네트워킹을 수행하는 플러그인 또한 도커 이미지로 배포되기때문에 그러한 특수한 컨테이너 같은 경우 권한을 가져야한다. 그래서 컨테이너내의 특수 목적의 컨테이너 배포 할때는 
적절한 특수 권한이 부여될텐데 그런것들 확인가능
이쪽은 영상 따라가보면서 습득!

쿠버네티스 환경에서 exec명령어 쓸라면 어디 ns인지 명시 해주기 안하면 default로됨

**쿠버네티스 네트워크 통신 유형**
1. container-to-container
2. Pod-to-Pod
3. Pod-to-Service(내부 서비스간 통신)
4. External-to-Service(외부 서비스간 통신)

**파드 투 파드 통신**
모든 파드는 고유한 IP주소를 갖는다.
파드내의 컨테이너는 Pod IP주소를 공유한다.

파드안에는 파드의 ip부여하기 위해  pause컨테이너가 무조건 올라간다.
사실 파드내 메인컨테이너는 1개인데 다른놈들은 메인을 도와주는 헬퍼 컨테이너(사이드카 컨테이너)

만약에 파드가 다른 노드로 배포가 되는 한경에서 기본적으로 도커자체 매커니즘으로 올라가게되면 다른 호스트환경에 같은 서브넷으로 올라갈텐데
그러면 통신에 문제가 생긴다 ip충돌난다. 그래서 쿠버네티스에서는 이 매커니즘 네트워킹 지원 안해서 그러다 보니 별도의 플러그인 통해
파드 투 파드 네트워킹 지원해야된다. 이에 따른 다양한 네트워크 플러그인이있다.
IP-in-IP:encapsulation 방식, BGP : routing table sharing, Overlay(VxLAN) : encapsulation , Direct(no-encapsulation)
IP-in-IP 나 Overlay는 다른 노드에 파드가 배포되어도 가상의 터널링 방식으로 통신지원

또 yaml명세서에서 kind에서 Network Policy를 적용해서 파드간의 트래픽 제어도 가능하다. 예를들어 ingress라고
어떤 ns 에서 들어오는 패킷들을 허용할지 이런거 적용해서 방화벽을 적용해서 사용할수있다. 나가는 패킷인 egress에도 
