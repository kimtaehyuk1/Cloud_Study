데이터 저장 방식

오브젝트 스토리지  
• 오브젝트라고 불리는 개별 유닛에 데이터를 저장하는 스토리지 포맷  
• 각 유닛에는 고유의 식별자 혹은 키가 있어서 분산된 시스템 내 어디에 저장되어 있든지 상관없이 데이터를 찾을 수 있음  
• 각각의 오브젝트에는 키, 데이터 및 옵션 메타데이터가 포함  
• Amazon S3  

블록 스토리지  
• 데이터를 고정된 사이즈의 블록으로 나누어 각각 고유한 식별자와 함께 저장하는 방식  
• 각 데이터 블록은 고유 식별자를 부여 받아 스토리지 시스템이 데이터 조각을 원하는 곳에 배치 가능 예, 일부 데이터 는 리눅스 환경에 저장하고 일부는 Windows 장치에 저장  
• Amazon EBS  

파일 스토리지  
• 데이터는 계층적 파일 디렉터리 내의 폴더에서 파일로 저장  
• 해당 데이터에 액세스해야 하는 경우, 컴퓨터는 그 데이터를 찾기 위해 경로를 알아야 함  
• 파일에 저장된 데이터는 제한된 양의 메타데이터(해당 파일 자체가 보관된 정확한 위치를 알려주는 데이터)를 사용해 구성 및 검색  
• Amazon EFS, Amazon FSx  

![image](https://user-images.githubusercontent.com/67897827/181451771-b4634ac1-09a8-4346-8ad5-df79b723719a.png)

(실습)
S3서비스 들어가서 버킷만들기,버킷이름유니크하게 지정,리전서울 선택,나머진 일단 냅두고 생성하기 -> 만들어 진거 눌러서 객체 업로드,파일추가후업로드 근데 여기까지만하면
객체 url로 들어가면 deny뜸

S3 버전 관리 (Versioning)  
• 객체(파일)이 여러 버전을 가질 수 있음  
• 동일한 파일이름을 업로드 하면 여러 버전으로 저장됨(예, 버전1, 버전2…)  
• 실수로 객체를 덮어쓰거나 삭제한 경우 이전 버전으로 복구 가능  
• 실수로 객체를 삭제 하는 것을 방지하기 위해 MFA Delete 옵션을 추가할 수 있음 (버전관리 + MFA Delete를 조합하면 삭제 방지가 더 강력함)  
• 객체를 하나의 파일이 아닌 여러 버전으로 보존 할 수 있음  
• 버전관리 기능을 사용하려면 해당 기능을 활성화 해야함  

(실습)
버킷눌러서 속성탭 클릭-> 버킷버젼관리 편집 눌러서 활성화 -> 이후에 똑같이 업로드 하면 이제 버젼 보인다. 삭제하고 버젼표시눌러도 영구삭제되지 않음 영구삭제하려면
버젼 표시해서 삭제 

![image](https://user-images.githubusercontent.com/67897827/181456858-58490bf7-a4cd-4320-aea3-5973cd5d82f4.png)

(실습)
버킷들어가서 -> 객체들어가기(있을경우) -> 속성내리다보면 암호화설정 편집. 또는 객체 업로드 과정에서 아래 속성에서도 할 수 있다. 또는 버킷에서 속성들어가서 기본 암호화
활성화 하면 이제부터 만드는 객체 암호화됨.

![image](https://user-images.githubusercontent.com/67897827/181458982-fd505882-8abb-4255-9efe-d0d785dd467b.png)

대부분의 정책에서는 버킷정책을 많이 사용하고, 퍼블릭 액세스는 정적 웹사이트 사용할때 퍼블릭 액세스 허용해주고, ACL보다는 버킷정책에서 계정에 권한 부여 많이 사용한다.

(실습)
버킷들어가면 권한 탭에 있다. 우리는 실습을 버킷정책을 해본다. 정책 예제도 있고 정책생성기가 있다. -> 정책 생성기 눌러서, 정책유형에 S3버킷정책,effect는 Deny하고
,principal에 * 는 모두이다, 액션에는 putobject(이건 버킷에 파일을 저장하는 것이다.) ARN는 버킷이름인데 버킷정책 편집칸에 버킷 ARN있다 이거 복사해서 붙이기 + /* 붙여서
이름 쓰고, add condition눌러서 조건값 줄건데 Condition에 null값 주고 key에는 s3:x-amz-server-side-encrytion이고 value는 true 하고 Add condition 클릭하고 Add Statement클릭
하고 Generate Policy클릭 하면 생성됨 그러면 json형태로 보여지게 되면 복사해서 정책창에 붙여놓자
즉!! 여기까지 말은 만약에 암호화를 하지 않으면 파일을 버킷에 업로드 하는것을 거부 하겠다이다!! 즉 업로드 할때 암호화 지정하지 않으면 업로드 안된다.


S3 정적 웹사이트 호스팅  
• S3에서 정적 웹사이트만 호스팅 가능  
• 정적 웹사이트: 언제 접속해도 항상 같은 내용을 보여주는 변하지 않는 사이트 (예, 회사 소개 홈페이지)  
• 동적 웹사이트: 접속할 때마다 다른 내용이 변하는 사이트 (커뮤니티 홈페이지, SNS 홈페이지, 쇼핑몰 등)  
• S3에서 웹사이트 호스팅을 하면 EC2 등의 별도의 웹서버 운영을 하지 않아도 됨  
• 웹사이트 주소는 버킷이름.s3-website-리전.amazonaws.com 형식  
• 사이트 접속시 403에러가 나오면 버킷의 퍼블릭 액세스 허용이 안되어 있다는 것임  

(실습)
버킷에 4개파일 업로드해서 이거가지고 정적 웹사이트구현 할건데 -> 속성 탭 클릭 해서 정적 웹 사이트 호스팅 편집 눌러서 -> 활성화,호스팅유형:정적,인덱스문서칸에 업로드한 파일
중 하나인 index.html쳐주고,오류문서엔 error.html후 변경사항 저장하면 속성 웹사이트 칸에 활성화되서 url이 나오는데 이상태로 퍼블릭 액세스 허용안되서 403에러 뜬다.

다시 버킷으로 가서 권한에서 퍼블릭 엑세스 차단에서 편집누르고, 모든 퍼블릭 액세스 차단 체크 해제하고 모두 허용해서 변경사항 저장하면 그 후에 버킷정책에서 
이 버킷에 대해 액세스 가능하게 허용해주기 위해 정책생성기에서 정책유형에 S3버킷정책,effect는 Allow하고,principal에 * 는 모두이다, 액션에는 getobject(객체를 가져오는 권한 허용.)  
ARN는 버킷이름인데 버킷정책 편집칸에 버킷 ARN있다 이거 복사해서 붙이기 + /* 붙여서 이름 쓰고 Add Statement클릭 하고 Generate Policy클릭 하면 생성됨 
그러면 json형태로 보여지게 되면 복사해서 정책창에 붙여놓자


CORS

![image](https://user-images.githubusercontent.com/67897827/181493665-b7b28568-b9c6-449c-a851-f590ed21bb47.png)


액세스 로깅 (Access Logs)  
• S3 버킷의 모든 활동 (접속, 읽기, 쓰기, 변경 등)을 파일로 만들어 S3 버킷이 저장하는 기능  
• 감사 목적으로 활용 가능  
• 로그 분석을 위해 Amazon Athena같은 분석 도구를 사용 가능  
• 절대로 로그 파일 저장소를 같은 버킷에 하지 말것! (무한루프로 인해 로그파일 지속적 증가) = 운영버킷과 로그버킷이 같으면 무한루프 생긴다는 것.  

(실습)
버킷하나있는 것은 운영버킷이고 지금은 운영버킷에서 생기는 로그들을 따로 저장할 로그버킷 하나 만들기 -> 버킷생성하기,같은리전에,나머지값그대로냅두고 생성 -> 만들어진
버킷에서 속성에가면 서버 엑세스 로깅이있다 편집-> 활성화,버킷선택할때 로그저장으로 방금 만든 버킷클릭


S3 Replication (복제 규칙)  
• S3 버킷 간에 객체를 자동으로 복제하는 기능  
• 2가지 복제 유형  
교차 리전 복제 (CRR, Cross Region Replication)  
✓ 서로 다른 AWS 리전의 S3 버킷으로 객체를 복사  
✓ 사용사례:  
지리적으로 가까운 액세스가 필요한 경우(한국이 오리진인데 미국에서 가까이 쓸일이 있을경우)  
재해복구(DR)  
동일 리전 복제 (SRR, Same Region Replication)  
✓ 같은 AWS 리전의 S3 버킷으로 객체를 복사  
✓ 사용사례:  
동일한 데이터를 사용하는 프로덕션과 테스트계정 간의 복제  
법적 준수사항으로 같은 리전안에 데이터 복사본을 만들어 놓아야 하는 경우  
• 버킷 복제를 위해서는 원본과 대상 버킷 모두 버전관리가 활성화 되어 있어야 함  
• 다른 AWS 계정의 버킷으로도 복제 가능  
• 복제 기능 활성화 이후 버킷에 새로 저장 된 오브젝트만 복제 (활성화 이전에 저장된 오브젝트는 복제 안함)  


(실습)
우선 버킷 오리진과 오리진아닌거 리전다르게 버전관리 활성화 해서 만들기 -> 오리진에 사진파일 업로드 후 관리 탭에 가서 복제규칙생성 이름쓰고,소스버킷범위를 버킷의 모든
객체에 적용 대상에서는 이 계정에서 버킷선택 후 버킷이름에 replica로만든 버킷 넣주기(이게 교차 리전 복제임),IAM역할에선 새역할 생성해서 후 저장 이렇게되면
오리진에서 파일 업로드하면 레플리카 버킷에 같이 업로드 된다.


![image](https://user-images.githubusercontent.com/67897827/181563121-d46b4901-fcdd-4650-9d1d-d055a3435eae.png)

![image](https://user-images.githubusercontent.com/67897827/181563414-4f25f4df-72fd-4fbc-82da-324807c6d51f.png)

![image](https://user-images.githubusercontent.com/67897827/181562366-e2b26e4d-07b9-4027-839c-5e9a2561c6a6.png)



객체 수명주기 관리

![image](https://user-images.githubusercontent.com/67897827/181565548-1fdd885a-93a5-4b1f-9dfe-244906a43f11.png)

(실습)
버킷 관리에 수명주기관리에서 생성-> 이름적당히써주고,버킷의모든규칙적용(동의체크),수명주기규칙작업에서 우린 현재버전이동,클래스간객체의 현재 버전전화에서 추가해가면서
몇일마다 뭘로 갈건지 선택하기 

S3 기타 기능  
이벤트 알림  
• S3의 이벤트가 발생할 때마다 알리는 기능  
• 이벤트는 객체의 생성, 복제, 복원 등이 있음  
• 생성된 이벤트 알림을 Amazon SNS, Amazon SQS, AWS Lambda로 보낼 수 있음  
• 예, 객체가 삭제될 때 마다 S3에서 Amazon SNS로 이벤트 알림을 보내 사용자의 이메일로 전송  
• 예, 객체가 생성될 때 마다 Lambda를 이용하여 파일을 처리하는 함수 구성  
객체 잠금  
• Object Lock(객체 잠금), Glacier Vault Lock(글라시아 아카이브 잠금) 2가지 잠금이 있음  
• 일정시간 또는 무기한으로 객체가 삭제되거나 덮어쓰이지 않도록 하는 기능으로 읽기만 가능  
• 법적인 보존기간이 있는 객체의 경우에 사용  
요청자 지불 버킷(Requested Pays)  
• 일반적으로 버킷에 데이터를 다운로드 하거나 업로드 할 때 비용은 버킷 소유자가 지불  
• 데이터 전송비용을 버킷 소유자가 아닌 요청자(데이터를 다운로드 업로드 하는 사람)이 지불하는 기능  
미리 서명된 URL (Pre-Signed URL)  
• 미리 서명된 URL을 사용하여 제한 된 시간동안 객체를 공유 또는 업로드하는 만료 시간을 설정  
전송 가속화(Amazon S3 Transfer Acceleration)  
• S3버킷의 객체를 사용자에게 더 빠르게 전송해 주는 기능  
• AWS의 엣지로케이션을 활용해서 S3데이터를 사용자와 가까운 곳에 캐싱하여 전송  
• 전 세계 각지에서 중앙의 버킷으로 업로드하는 고객이 있는 경우에 사용(굳이 중앙까지 업로드 안하고 엣지까지만 하면 되니까)  
멀티 파트 업로드  
• 대용량의 파일을 분할하여 병렬로 S3에 업로드 하는 방식  
• 파트를 병렬로 업로드 하기에 빠른 처리 속도로 업로드 가능  
• 업로드가 실패하면 재전송 또는 수명 주기 정책을 통해 완료되지 않은 업로드 삭제 가능  
S3 데이터 검색  
• Athena, S3 Select, Redshift 등의 서비스를 사용해서 S3의 데이터를 다른 플랫폼으로 이동하지 않고 바로 검색 가능  
• SQL 쿼리문을 사용해서 검색 가능  
AWS Transfer for SFTP  
• S3 버킷을 저장소로 하는 SFTP 서비스  
• SFTP(Secure File Transfer Protocol)는 보안 파일 전송 프로토콜  
• 온-프레미스나 외부의 다른 시스템에서 SFTP를 이용하여 S3 버킷으로 파일을 전송하고 관리 가능  






