![image](https://user-images.githubusercontent.com/67897827/181698412-4cd5c273-4ce3-4fb4-b5fc-35e7f353ff02.png)

CloudFront 특징  
• 사용자에게 가까운 곳의 엣지로케이션에서 데이터를 전송  
• 글로벌 배포  
• 전세계 사용자에게 최상의 경험을 제공  
• 콘텐츠 지연시간을 최소화 하면서 제공  
• 비디오 콘텐츠 등의 실시간 스트리밍 배포  
• 웹사이트 속도를 높여 해외사용자에게 향상된 브라우징 경험  
• EC2 등의 오리진 서버의 부하를 줄일 수 있음  
• 오리진에서 CloudFront로 전송되는 비용은 부과 되지 않으므로 비용 절감 효과가 있음  
• 사용자의 요청 헤더 값(디바이스, 최종 사용자의 위치, 최종 사용자가 사용하는 언어 및 다양한 조건)에 따라 서로 다른 버전의 콘텐츠를 캐싱하여 제공할 수 있음  

![image](https://user-images.githubusercontent.com/67897827/181698919-ad1317f1-9ce1-458f-baf3-99cdf321cd45.png)

![image](https://user-images.githubusercontent.com/67897827/181699103-47d0ea4a-be9e-49b3-b35a-87f39005a02c.png)

Lambda@Edge  
• CloudFront를 통해 전달되는 콘텐츠를 사용자 지정하는 함수를 실행할 수 있게 해주는 AWS Lambda가 확장된 컴퓨팅 서비스  
• Node.js 또는 Python 함수를 작성한 후 사용자와 가까운 엣지 로케이션에서 해당 함수를 실행  
• 다음과 같은 CloudFront 이벤트가 발생할 때 Lambda 함수를 실행  
✓ CloudFront가 최종 사용자의 요청을 수신할 때(최종 사용자 요청)  
✓ CloudFront가 오리진에 요청을 전달하기 전(오리진 요청)  
✓ CloudFront가 오리진의 응답을 수신할 때(오리진 응답)  
✓ CloudFront가 최종 사용자에게 응답을 반환하기 전(최종 사용자 응답)  
• Lambda@Edge 사용 예  
✓ A/B 테스트를 위해 사이트의 다양한 버전을 볼 수 있도록 쿠키를 검사하고 URL을 다시 작성  
✓ User-Agent 헤더를 확인하여 사용 중인 디바이스를 기반으로 디바이스의 화면 크기에 따라 다른 이미지를 반환  
✓ 최종 사용자 요청 또는 오리진 요청 이벤트가 발생할 때 HTTP 응답을 생성  
✓ 데이터 전송 비용을 줄이기 위해 사용자에게 전송되는 파일을 압축  

(실습)
오리진을 만들어주기 위해 S3에서 버킷을 생성 -> 버킷이름 적당히짓고,ACL활성화로바꾸기,모든퍼블릭엑세스차단체크해제,버전관리활성화 후 버킷만들기 후
버킷에 이전시간 정적호스팅하기 위해서 업로드시킬 4개 업로드 -> 객체에 퍼블릭 액세스권한 주기위해서 index.html 클릭해서 권한에서 편집눌러서, 모든사람(퍼블릭액세스)객체
읽기 체크하고 이해합니다에 체크하고 저장 이렇게 두 jpg파일도 똑같이해주기 이것을 오리진으로하는 CloudFrnot만들기 위해

CloudFront서비스 배포 생성 -> 원본도메인에 방금 만든 S3버킷 고르기,지금은 OAI사용안함으로  하고 일단 나머지는 냅두고 기본값 루트객체에 index.html로 써주고 배포생성
이러면 서울에서만든 버킷을 클라우드프론트를 통해서 전세계에 엣지로케이션에 배포한것이다. 따라서 배포도메인 이름으로 접속하게 되면 만약 미국에 있는 사용자는 미국에있는
엣지로케이션으로 접속하게 된다.

(주의) 방금한것은 CloudFront도메인으로 가면 접속되고 또한OAI설정 안해서 S3로 직접 접근하는 퍼블릭액세스가 되는것이다. 

CloudFront 보안
1. 뷰어/오리진 프로토콜 정책
![image](https://user-images.githubusercontent.com/67897827/181702671-1337b4e5-a80d-4c18-8f6d-62f589e40275.png)

![image](https://user-images.githubusercontent.com/67897827/181707531-68caed19-b3de-4458-bdb7-766d76da5985.png)

Cloud Front 보안 액세스  
• Singed URL, Signed Cookies  
✓ 서명된 URL또는 쿠키를 이용해서 콘텐츠에 접속하는 기능  
✓ URL또는 쿠키에는 콘텐츠만료기간, 액세스가능한 IP주소를 저장할 수 있음  
✓ 유료 콘텐츠나 보안을 위해 콘텐츠의 유효/만료 기간을 지정해야 하는 경우 사용 (예, 승인된 사용자만 콘텐츠를 볼 수 있도록 허용)  
✓ 서명된 URL은 1개의 파일에 1개의 서명만 저장 (1개의 파일 접속을 위한 URL)  
✓ 서명된 쿠키는 하나의 쿠키로 여러 개의 파일 접속 가능  
• 지역 제한 (Geographic Restrictions)  
✓ 특정 국가에서의 콘텐츠 액세스를 제한 하는 기능  
✓ 법률적인 사항으로 국가별로 저작권이 다른 경우에 사용가능  
✓ 2가지 지리적 제한 옵션  
➢ 화이트리스트(Whitelist): 리스트에 있는 국가만 액세스 허용하고 나머지는 모두 거부  
➢ 블랙리스트(Blacklist): 리스트에 있는 국가만 액세스 거부하고 나머지는 모두 허용  
• AWS Web Application Firewall(WAF), AWS Shield와 결합해 DDoS 방어 기능을 함  
• 필드 레벨 암호화  
✓ 신용 카드 번호와 같이 사용자가 제출한 데이터를 안전하게 오리진 서버로 업로드할 수 있게 해주는 CloudFront의 기능
✓ PUT/POST 요청이 오리진으로 전달되기 전에 엣지로케이션에서 비대칭 암호화 키를 사용하여 데이터를 추가로 암호화  
✓ 데이터는 프라이빗 키를 가진 애플리케이션만 복호화 할 수 있음  

(실습)  
S3버킷에가서 권한에 가면 버킷정책이 비어있는데 -> 다시 CloudFront로 가서 보안창에 원본 액세스ID를 클릭하고 생성눌러서 이름만들고 생성하기 -> 왼쪽창 배포에 생성된 배포
클릭하고 원본탭에가서 해당배포클릭하고 편집누르면 -> S3버킷액세스칸에 OAI사용 클릭,ID에 방금생성한 이름 클릭,버킷정책업데이트하느걸로체크 후 변경사항 저장 해서 다시
S3버킷 권한 버킷정책이 채워져있다. -> 그후 버킷 권한에서 퍼블릭 액세스차단 -> CloudFront 동작 탭에서 편집 -> 뷰어프로토콜에서 HTTP to HTTPS 로 바꿔주기

이러면 S3로 직접 접속하는것은 안되고 CloudFront도메인으로 접속해야 된다.
 
